<div class="register-wrapper">
    <header>
        <div class="logo">
            <img src="assets/moveo.png" alt="Moveo Logo" />
            <span>MOVEO</span>
        </div>
        <button class="signup-button">Sign Up</button>
    </header>

    <main class="register-box">
        <div class="form-section">
            <h1>Provider Security</h1>
            <p>Additional verification for car providers</p>

            <form [formGroup]="securityForm" (ngSubmit)="onSubmit()">
                <div class="form-grid">
                    <mat-form-field appearance="outline">
                        <mat-label>Full Name</mat-label>
                        <input matInput formControlName="fullName" placeholder="Enter your full name" />
                        <mat-icon matSuffix>person</mat-icon>
                        <mat-error *ngIf="securityForm.get('fullName')?.hasError('required')">
                            Name is required
                        </mat-error>
                    </mat-form-field>

                    <mat-form-field appearance="outline">
                        <mat-label>Phone Number</mat-label>
                        <input matInput formControlName="phone" placeholder="Enter your phone" />
                        <mat-icon matSuffix>phone</mat-icon>
                        <mat-error *ngIf="securityForm.get('phone')?.hasError('required')">
                            Phone is required
                        </mat-error>
                    </mat-form-field>

                    <mat-form-field appearance="outline">
                        <mat-label>DNI / License Number</mat-label>
                        <input matInput formControlName="dni" placeholder="Enter your DNI" />
                        <mat-icon matSuffix>badge</mat-icon>
                        <mat-error *ngIf="securityForm.get('dni')?.hasError('required')">
                            DNI is required
                        </mat-error>
                        <mat-error *ngIf="securityForm.get('dni')?.hasError('pattern')">
                            DNI must be 8 digits
                        </mat-error>
                    </mat-form-field>

                    <mat-form-field appearance="outline">
                        <mat-label>Email</mat-label>
                        <input matInput type="email" formControlName="email" placeholder="Enter your email" />
                        <mat-icon matSuffix>email</mat-icon>
                        <mat-error *ngIf="securityForm.get('email')?.hasError('required')">
                            Email is required
                        </mat-error>
                        <mat-error *ngIf="securityForm.get('email')?.hasError('email')">
                            Valid email required
                        </mat-error>
                    </mat-form-field>

                    <mat-form-field appearance="outline">
                        <mat-label>Password</mat-label>
                        <input matInput [type]="hidePassword ? 'password' : 'text'" formControlName="password" placeholder="Create password" />
                        <button mat-icon-button matSuffix (click)="hidePassword = !hidePassword" type="button">
                            <mat-icon>{{hidePassword ? 'visibility_off' : 'visibility'}}</mat-icon>
                        </button>
                        <mat-error *ngIf="securityForm.get('password')?.hasError('required')">
                            Password is required
                        </mat-error>
                    </mat-form-field>

                    <mat-form-field appearance="outline">
                        <mat-label>Repeat Password</mat-label>
                        <input matInput [type]="hideRepeatPassword ? 'password' : 'text'" formControlName="repeatPassword" placeholder="Confirm password" />
                        <button mat-icon-button matSuffix (click)="hideRepeatPassword = !hideRepeatPassword" type="button">
                            <mat-icon>{{hideRepeatPassword ? 'visibility_off' : 'visibility'}}</mat-icon>
                        </button>
                        <mat-error *ngIf="securityForm.hasError('mismatch') && securityForm.get('repeatPassword')?.touched">
                            Passwords must match
                        </mat-error>
                    </mat-form-field>
                </div>

                <div class="photo-upload-section">
                    <h3>Profile Photo (Optional)</h3>
                    <div class="photo-upload" (click)="photoInput.click()">
                        <div class="photo-preview" *ngIf="selectedFile; else noPhoto">
                            <img [src]="photoPreview" alt="Profile preview" />
                        </div>
                        <ng-template #noPhoto>
                            <div class="photo-placeholder">
                                <mat-icon>add_a_photo</mat-icon>
                                <span>Add Profile Photo</span>
                            </div>
                        </ng-template>
                    </div>
                    <input #photoInput type="file" (change)="onPhotoSelected($event)" accept="image/*" hidden />
                </div>

                <div class="file-uploads">
                    <div class="upload-item">
                        <label class="upload-link">
                            <input type="file" (change)="onInsuranceSelected($event)" accept=".pdf,image/*" hidden />
                            <mat-icon>description</mat-icon>
                            Upload Car Insurance
                        </label>
                    </div>

                    <div class="upload-item">
                        <label class="upload-link">
                            <input type="file" (change)="onCardSelected($event)" accept=".pdf,image/*" hidden />
                            <mat-icon>credit_card</mat-icon>
                            Upload Car Ownership Card
                        </label>
                    </div>
                </div>

                <div class="terms-section">
                    <mat-checkbox formControlName="acceptTerms" [disabled]="!hasReadTerms">
                        I accept the <a href="#" (click)="openTermsDialog($event)">Terms and Conditions</a>
                    </mat-checkbox>
                    <mat-error *ngIf="securityForm.get('acceptTerms')?.hasError('required') && securityForm.get('acceptTerms')?.touched">
                        You must accept the terms and conditions
                    </mat-error>
                </div>

                <button mat-raised-button color="primary" type="submit" [disabled]="securityForm.invalid || isLoading" class="submit-button">
                    <mat-spinner *ngIf="isLoading" diameter="20"></mat-spinner>
                    <span *ngIf="!isLoading">Create Provider Account</span>
                </button>
            </form>

            <a routerLink="/login" class="signin-link">Already a member? Sign In</a>
        </div>
    </main>
</div>
